============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.3.0, pluggy-1.6.0 -- C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-0.25.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None
collecting ... collected 5 items

tests/api/test_presets.py::test_get_presets_empty ERROR                  [ 20%]
tests/api/test_presets.py::test_initialize_presets ERROR                 [ 40%]
tests/api/test_presets.py::test_get_preset_details ERROR                 [ 60%]
tests/api/test_presets.py::test_get_preset_not_found ERROR               [ 80%]
tests/api/test_presets.py::test_apply_preset_authenticated ERROR         [100%]

=================================== ERRORS ====================================
__________________ ERROR at setup of test_get_presets_empty ___________________
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\api\test_presets.py, line 8
  @pytest.mark.asyncio
  async def test_get_presets_empty(client: AsyncClient):
      """Test getting presets when none exist."""
      response = await client.get("/api/v1/presets")
      assert response.status_code == 200
      assert response.json() == []
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py, line 69
  @pytest_asyncio.fixture
  async def client(test_db: AsyncSession) -> AsyncGenerator[AsyncClient, None]:
      """Create async test client with overridden dependencies."""

      async def override_get_db():
          yield test_db

      app.dependency_overrides[get_db] = override_get_db

      async with AsyncClient(
          transport=ASGITransport(app=app),
          base_url="http://test"
      ) as client:
          yield client

      app.dependency_overrides.clear()
E       fixture 'test_db' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, test_settings, test_user, tests/api/test_presets.py::<event_loop>, tests/api::<event_loop>, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:69
__________________ ERROR at setup of test_initialize_presets __________________
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\api\test_presets.py, line 15
  @pytest.mark.asyncio
  async def test_initialize_presets(client: AsyncClient):
      """Test initializing built-in presets."""
      response = await client.post("/api/v1/presets/initialize")
      assert response.status_code == 200
      assert "Loaded" in response.json()["message"]

      # Verify presets were actually loaded
      response = await client.get("/api/v1/presets")
      assert response.status_code == 200
      data = response.json()
      assert len(data) > 0

      # Check structure of the first preset
      preset = data[0]
      assert "id" in preset
      assert "name" in preset
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py, line 69
  @pytest_asyncio.fixture
  async def client(test_db: AsyncSession) -> AsyncGenerator[AsyncClient, None]:
      """Create async test client with overridden dependencies."""

      async def override_get_db():
          yield test_db

      app.dependency_overrides[get_db] = override_get_db

      async with AsyncClient(
          transport=ASGITransport(app=app),
          base_url="http://test"
      ) as client:
          yield client

      app.dependency_overrides.clear()
E       fixture 'test_db' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, test_settings, test_user, tests/api/test_presets.py::<event_loop>, tests/api::<event_loop>, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:69
__________________ ERROR at setup of test_get_preset_details __________________
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\api\test_presets.py, line 33
  @pytest.mark.asyncio
  async def test_get_preset_details(client: AsyncClient):
      """Test getting full details of a preset."""
      # First initialize
      await client.post("/api/v1/presets/initialize")

      # Get all presets to find an ID
      list_response = await client.get("/api/v1/presets")
      presets = list_response.json()
      assert len(presets) > 0
      preset_id = presets[0]["id"]

      # Get details
      response = await client.get(f"/api/v1/presets/{preset_id}")
      assert response.status_code == 200
      data = response.json()
      assert data["id"] == preset_id
      assert "configuration" in data  # configuration SHOULD be in details view
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py, line 69
  @pytest_asyncio.fixture
  async def client(test_db: AsyncSession) -> AsyncGenerator[AsyncClient, None]:
      """Create async test client with overridden dependencies."""

      async def override_get_db():
          yield test_db

      app.dependency_overrides[get_db] = override_get_db

      async with AsyncClient(
          transport=ASGITransport(app=app),
          base_url="http://test"
      ) as client:
          yield client

      app.dependency_overrides.clear()
E       fixture 'test_db' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, test_settings, test_user, tests/api/test_presets.py::<event_loop>, tests/api::<event_loop>, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:69
_________________ ERROR at setup of test_get_preset_not_found _________________
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\api\test_presets.py, line 52
  @pytest.mark.asyncio
  async def test_get_preset_not_found(client: AsyncClient):
      """Test getting a non-existent preset."""
      random_id = str(uuid4())
      response = await client.get(f"/api/v1/presets/{random_id}")
      assert response.status_code == 404
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py, line 69
  @pytest_asyncio.fixture
  async def client(test_db: AsyncSession) -> AsyncGenerator[AsyncClient, None]:
      """Create async test client with overridden dependencies."""

      async def override_get_db():
          yield test_db

      app.dependency_overrides[get_db] = override_get_db

      async with AsyncClient(
          transport=ASGITransport(app=app),
          base_url="http://test"
      ) as client:
          yield client

      app.dependency_overrides.clear()
E       fixture 'test_db' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, test_settings, test_user, tests/api/test_presets.py::<event_loop>, tests/api::<event_loop>, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:69
______________ ERROR at setup of test_apply_preset_authenticated ______________
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\api\test_presets.py, line 59
  @pytest.mark.asyncio
  async def test_apply_preset_authenticated(client: AsyncClient, auth_headers: dict):
      """Test applying a preset to create a pipeline (authenticated)."""
      # Initialize presets
      await client.post("/api/v1/presets/initialize")
      list_response = await client.get("/api/v1/presets")
      preset_id = list_response.json()[0]["id"]

      # Apply preset
      response = await client.post(
          f"/api/v1/presets/{preset_id}/apply",
          headers=auth_headers,
          params={"pipeline_name": "Test Pipeline from Preset"}
      )
      assert response.status_code == 200
      data = response.json()
      assert "pipeline_id" in data
      assert data["pipeline_name"] == "Test Pipeline from Preset"
file C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py, line 69
  @pytest_asyncio.fixture
  async def client(test_db: AsyncSession) -> AsyncGenerator[AsyncClient, None]:
      """Create async test client with overridden dependencies."""

      async def override_get_db():
          yield test_db

      app.dependency_overrides[get_db] = override_get_db

      async with AsyncClient(
          transport=ASGITransport(app=app),
          base_url="http://test"
      ) as client:
          yield client

      app.dependency_overrides.clear()
E       fixture 'test_db' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, client, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, test_settings, test_user, tests/api/test_presets.py::<event_loop>, tests/api::<event_loop>, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:69
============================== warnings summary ===============================
..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\formparsers.py:12
  C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
  C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
ERROR tests/api/test_presets.py::test_get_presets_empty
ERROR tests/api/test_presets.py::test_initialize_presets
ERROR tests/api/test_presets.py::test_get_preset_details
ERROR tests/api/test_presets.py::test_get_preset_not_found
ERROR tests/api/test_presets.py::test_apply_preset_authenticated
======================== 4 warnings, 5 errors in 0.02s ========================
