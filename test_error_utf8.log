pytest : C:\Users\ASMIT\AppData\
Local\Programs\Python\Python313\
Lib\site-packages\pytest_asyncio
\plugin.py:207: 
PytestDeprecationWarning: The 
configuration option "asyncio_de
fault_fixture_loop_scope" is 
unset.
At line:1 char:1
+ pytest backend/tests/api/test_
chunks.py > test_error.log 2>&1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : N 
   otSpecified: (C:\Users\ASMI  
  T\...cope" is unset.:String   
 ) [], RemoteException
    + FullyQualifiedErrorId : N 
   ativeCommandError
 
The event loop scope for 
asynchronous fixtures will 
default to the fixture caching 
scope. Future versions of 
pytest-asyncio will default the 
loop scope for asynchronous 
fixtures to function scope. Set 
the default fixture loop scope 
explicitly in order to avoid 
unexpected behavior in the 
future. Valid fixture loop 
scopes are: "function", 
"class", "module", "package", 
"session"

  warnings.warn(PytestDeprecatio
nWarning(_DEFAULT_FIXTURE_LOOP_S
COPE_UNSET))
============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.3.0, pluggy-1.6.0 -- C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-0.25.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None
collecting ... collected 7 items

backend\tests\api\test_chunks.py::test_visualize_fixed_chunking FAILED   [ 14%]
backend\tests\api\test_chunks.py::test_visualize_sentence_chunking FAILED [ 28%]
backend\tests\api\test_chunks.py::test_visualize_paragraph_chunking FAILED [ 42%]
backend\tests\api\test_chunks.py::test_visualize_recursive_chunking FAILED [ 57%]
backend\tests\api\test_chunks.py::test_visualize_document_not_processed FAILED [ 71%]
backend\tests\api\test_chunks.py::test_visualize_invalid_overlap FAILED  [ 85%]
backend\tests\api\test_chunks.py::test_visualize_document_not_found PASSED [100%]

================================== FAILURES ===================================
________________________ test_visualize_fixed_chunking ________________________

client = <httpx.AsyncClient object at 0x0000027C844E8440>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmYjY5M2MyMy03MTIyLTQ1MDMtYjBiOS0xMDQxZjcwZGI2NWUiLCJleHAiOjE3NzA5MDgxNjYsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjZ9.mPjZGv3uNBhyE3jJYL32XKUtnr3-pTpvvvJhEeOufmw'}
test_document_with_text = <app.models.models.Document object at 0x0000027C844EAA50>

    @pytest.mark.asyncio
    async def test_visualize_fixed_chunking(
        client: AsyncClient,
        auth_headers: dict,
        test_document_with_text: Document,
    ):
        """Test fixed-size chunking visualization."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_with_text.id),
                "chunking_config": {
                    "method": "fixed",
                    "chunk_size": 50,
                    "overlap": 10,
                },
            },
        )
    
>       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:74: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:06 [info     ] request_completed              duration_ms=293.16 method=POST path=/api/v1/auth/login request_id=bec7223d status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:06 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/test123.pdf' not found" request_id=d4733ae7 status_code=404
2026-02-12 19:56:06 [warning  ] request_completed              duration_ms=6.07 method=POST path=/api/v1/chunks/visualize request_id=d4733ae7 status_code=404
______________________ test_visualize_sentence_chunking _______________________

client = <httpx.AsyncClient object at 0x0000027C84918B90>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiZWY3YzhlOC05MTAyLTRiMDUtOTYwNi05MmRmNTk0MjZkYjYiLCJleHAiOjE3NzA5MDgxNjcsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjd9.9JqKxzB-lJ_F_sDSK5OwRjqRL8pSWvB4tq9lX8AF9rE'}
test_document_with_text = <app.models.models.Document object at 0x0000027C8491A210>

    @pytest.mark.asyncio
    async def test_visualize_sentence_chunking(
        client: AsyncClient,
        auth_headers: dict,
        test_document_with_text: Document,
    ):
        """Test sentence-based chunking visualization."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_with_text.id),
                "chunking_config": {
                    "method": "sentence",
                    "chunk_size": 100,
                    "overlap": 0,
                },
            },
        )
    
>       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:102: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:07 [info     ] request_completed              duration_ms=275.18 method=POST path=/api/v1/auth/login request_id=4823be02 status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:07 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/test123.pdf' not found" request_id=006718e6 status_code=404
2026-02-12 19:56:07 [warning  ] request_completed              duration_ms=8.81 method=POST path=/api/v1/chunks/visualize request_id=006718e6 status_code=404
______________________ test_visualize_paragraph_chunking ______________________

client = <httpx.AsyncClient object at 0x0000027C846FA210>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZmFkYjEwZS1kOGQwLTQ4NTktYmExOS05NGM5NWVjYzFmZTkiLCJleHAiOjE3NzA5MDgxNjgsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjh9.ajGWDZ9CFMDlSHX1sGEsVaLZGrYNlPXUdros-XUJbi8'}
test_document_with_text = <app.models.models.Document object at 0x0000027C846F82D0>

    @pytest.mark.asyncio
    async def test_visualize_paragraph_chunking(
        client: AsyncClient,
        auth_headers: dict,
        test_document_with_text: Document,
    ):
        """Test paragraph-based chunking visualization."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_with_text.id),
                "chunking_config": {
                    "method": "paragraph",
                    "chunk_size": 500,
                    "overlap": 0,
                },
            },
        )
    
>       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:127: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:08 [info     ] request_completed              duration_ms=274.97 method=POST path=/api/v1/auth/login request_id=251c39f3 status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:08 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/test123.pdf' not found" request_id=d5efc4c8 status_code=404
2026-02-12 19:56:08 [warning  ] request_completed              duration_ms=5.1 method=POST path=/api/v1/chunks/visualize request_id=d5efc4c8 status_code=404
______________________ test_visualize_recursive_chunking ______________________

client = <httpx.AsyncClient object at 0x0000027C8493E650>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5YWMwYTE0ZC0zYWZmLTQzMjMtOGY1YS1mZmZkM2ZmNjU1N2QiLCJleHAiOjE3NzA5MDgxNjgsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjh9.WclPLLEqUNQR4jmXREPxTRKLLDTwfe9OXahpcHwyC_M'}
test_document_with_text = <app.models.models.Document object at 0x0000027C8493E520>

    @pytest.mark.asyncio
    async def test_visualize_recursive_chunking(
        client: AsyncClient,
        auth_headers: dict,
        test_document_with_text: Document,
    ):
        """Test recursive chunking visualization."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_with_text.id),
                "chunking_config": {
                    "method": "recursive",
                    "chunk_size": 60,
                    "overlap": 10,
                },
            },
        )
    
>       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:152: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:08 [info     ] request_completed              duration_ms=269.43 method=POST path=/api/v1/auth/login request_id=5bbd376b status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:08 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/test123.pdf' not found" request_id=1e2c36b6 status_code=404
2026-02-12 19:56:08 [warning  ] request_completed              duration_ms=6.21 method=POST path=/api/v1/chunks/visualize request_id=1e2c36b6 status_code=404
____________________ test_visualize_document_not_processed ____________________

client = <httpx.AsyncClient object at 0x0000027C8493EC40>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2MTJmY2JlZi1iMzM0LTRkNzItYjE2Yy0wYmNiZjg1NGM0ODkiLCJleHAiOjE3NzA5MDgxNjksInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjl9.H-63aQ8ZDCV7lAESQemz5kwYa0VG137UAuHzOuHYIEQ'}
test_document_no_text = <app.models.models.Document object at 0x0000027C84994640>

    @pytest.mark.asyncio
    async def test_visualize_document_not_processed(
        client: AsyncClient,
        auth_headers: dict,
        test_document_no_text: Document,
    ):
        """Test error when document has no extracted text."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_no_text.id),
                "chunking_config": {"method": "fixed"},
            },
        )
    
>       assert response.status_code == 400
E       assert 404 == 400
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:173: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:09 [info     ] request_completed              duration_ms=265.09 method=POST path=/api/v1/auth/login request_id=5c5a9488 status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:09 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/unprocessed.pdf' not found" request_id=23db6d6e status_code=404
2026-02-12 19:56:09 [warning  ] request_completed              duration_ms=5.58 method=POST path=/api/v1/chunks/visualize request_id=23db6d6e status_code=404
_______________________ test_visualize_invalid_overlap ________________________

client = <httpx.AsyncClient object at 0x0000027C849C44D0>
auth_headers = {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4MmZiY2IxYi1iZGIwLTQ2NTYtYjdkYi0wNmQ5NGU4M2Y2ZGMiLCJleHAiOjE3NzA5MDgxNjksInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NzA5MDYzNjl9.a0SkhsRHUDnl6LRYO2y6hgpEUt1RLT1i-tY3UR4HBFU'}
test_document_with_text = <app.models.models.Document object at 0x0000027C849C60F0>

    @pytest.mark.asyncio
    async def test_visualize_invalid_overlap(
        client: AsyncClient,
        auth_headers: dict,
        test_document_with_text: Document,
    ):
        """Test error when overlap >= chunk_size."""
        response = await client.post(
            "/api/v1/chunks/visualize",
            headers=auth_headers,
            json={
                "document_id": str(test_document_with_text.id),
                "chunking_config": {
                    "method": "fixed",
                    "chunk_size": 50,
                    "overlap": 60,  # Invalid: overlap > chunk_size
                },
            },
        )
    
>       assert response.status_code == 400
E       assert 404 == 400
E        +  where 404 = <Response [404 Not Found]>.status_code

backend\tests\api\test_chunks.py:197: AssertionError
---------------------------- Captured stdout setup ----------------------------
2026-02-12 19:56:09 [info     ] request_completed              duration_ms=292.02 method=POST path=/api/v1/auth/login request_id=963a687f status_code=200
---------------------------- Captured stdout call -----------------------------
2026-02-12 19:56:09 [warning  ] app_exception                  code=NOT_FOUND message="File with id './uploads/test123.pdf' not found" request_id=1850c64d status_code=404
2026-02-12 19:56:09 [warning  ] request_completed              duration_ms=5.79 method=POST path=/api/v1/chunks/visualize request_id=1850c64d status_code=404
============================== warnings summary ===============================
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\formparsers.py:12
  C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295
  C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/api/test_chunks.py::test_visualize_fixed_chunking
  C:\Users\ASMIT\AppData\Local\Programs\Python\Python313\Lib\site-packages\pytest_asyncio\plugin.py:854: DeprecationWarning: The event_loop fixture provided by pytest-asyncio has been redefined in
  C:\Users\ASMIT\.gemini\antigravity\scratch\chunkscope\backend\tests\conftest.py:46
  Replacing the event_loop fixture with a custom implementation is deprecated
  and will lead to errors in the future.
  If you want to request an asyncio event loop with a scope other than function
  scope, use the "scope" argument to the asyncio mark when marking the tests.
  If you want to return different types of event loops, use the event_loop_policy
  fixture.
  
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED backend\tests\api\test_chunks.py::test_visualize_fixed_chunking - asse...
FAILED backend\tests\api\test_chunks.py::test_visualize_sentence_chunking - a...
FAILED backend\tests\api\test_chunks.py::test_visualize_paragraph_chunking - ...
FAILED backend\tests\api\test_chunks.py::test_visualize_recursive_chunking - ...
FAILED backend\tests\api\test_chunks.py::test_visualize_document_not_processed
FAILED backend\tests\api\test_chunks.py::test_visualize_invalid_overlap - ass...
=================== 6 failed, 1 passed, 5 warnings in 4.46s ===================
